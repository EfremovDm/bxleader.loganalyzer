## Модуль "Анализатор логов"
Модуль предназначен для поиска и анализа содержимого логов стандартного вида.

#### Возможности модуля
- Чтение логов следующих технологий: apache, nginx, mysql, php, cron, mail, bitrix, symfony, yii;
- Преобразование логов из технической строки в человекопонятный вид;
- Поиск в логах по датам, включаемым и/или исключаемым значениям;
- Быстрая работа с большими файлами логов (> 1Gb) через Linux-провайдер;
- Автоматическая работка с gz-упакованными файлами логов "на лету", без распаковки во временные файлы;
- Преобразование многострочных логов в понятные однострочные логические конструкции;
- Кроссплатформенная работа, с поддержкой ускорения на Linux через использование его системных утилит;
- Отслеживание запросов через Linux для быстрого получения необходимых запросов через консоль;
- Поддерживается внедрение регулярных выражений для пользовательских логов нестандартной конфигурации;
- Выделение группам пользователей прав на просмотр содержимого логов;
- Основные библиотеки модуля, находятся в папке ./lib, могут работать без ядра Битрикс.

#### Минимальные требования:
- Главный модуль Битрикс: 14.0.0, т.к. анализатор использует функции ядра D7.

#### Файловые провайдеры
- LinuxFileProvider - провайдер для работы с файлами через Linux-утилиты через exec php-функцию;
Linux-утилиты, необходимые для работы: ls, grep, wc, cat, zcat, gzip, head, tail, sed, perl;
Для использьзования данного провайдера требуется включенная php-фукнция exec;

- PhpFileProvider - провайдер для работы с файлами из PHP, является кроссплатформенным.
Для работы требуется библиотека zlib.

#### Установка модуля
Скопировать код модуля в папку /bitrix/modules/bxleader.loganalyzer или /local/modules/bxleader.loganalyzer

#### Cron-скрипты
Примеры скриптов периодической установки прав для возможности чтения логов
(т.к. хозяева данных логов их периодически сбрасывают)

Внимание:
- Это всего лишь примеры, вся ответственность за установку данных скриптов исключительно на Вас!
- Перед использованием проверьте владельца данных дирикторий и его права (команда ls -l),
т.к. возможен случай, когда службы работают не из под root.
- Особенно внимательны будьте с mysql, его пользователем и правами.
```
# Установка владельцев папок
* */1 * * * chown root:bitrix /var/log
* */1 * * * chown -R root:bitrix /var/log/httpd
* */1 * * * chown -R root:bitrix /var/log/nginx
* */1 * * * chown -R mysql:bitrix /var/log/mysql
* */1 * * * chown root:bitrix /var/log/cron*
* */1 * * * chown root:bitrix /var/log/maillog*

# Установка прав
* */1 * * * find /var/log/httpd -type d -exec chmod 750 {} \;
* */1 * * * find /var/log/httpd -type f -exec chmod 640 {} \;
* */1 * * * find /var/log/nginx -type d -exec chmod 750 {} \;
* */1 * * * find /var/log/nginx -type f -exec chmod 640 {} \;
* */1 * * * find /var/log/php -type d -exec chmod 750 {} \;
* */1 * * * find /var/log/php -type f -exec chmod 640 {} \;
* */1 * * * find /var/log/mysql -type d -exec chmod 750 {} \;
* */1 * * * find /var/log/mysql -type f -exec chmod 660 {} \;
* */1 * * * find /var/log/cron* -type f -exec chmod 640 {} \;
* */1 * * * find /var/log/maillog* -type f -exec chmod 640 {} \;
```

Синхронизация логов, хранящихся на другом сервере через rsync
```
ssh-keygen -t rsa
ssh-copy-id -i /root/.ssh/id_rsa.pub bitrix@10.2.3.4

0 1 * * * rsync -r -e "ssh" /var/log/mysql/ bitrix@10.2.3.4:/var/log/mysql/
```

